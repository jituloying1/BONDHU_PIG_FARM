<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>JP Pig Farm Management</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      background: url('th.jpg') no-repeat center center fixed;
      background-size: cover;
    }
    .container, .popup, #mainPage {
      max-width: 500px;
      margin: 40px auto;
      background: rgba(255, 255, 255, 0.95);
      padding: 20px;
      box-shadow: 0 0 10px #aaa;
      border-radius: 10px;
    }
    input, select, button {
      width: 100%;
      padding: 10px;
      margin: 10px 0;
    }
    .hidden { display: none; }
    .btn {
      background: #28a745;
      color: white;
      border: none;
      cursor: pointer;
    }
    .btn:hover { background: #218838; }
    .popup {
      position: fixed;
      top: 10%;
      left: 50%;
      transform: translateX(-50%);
      z-index: 10;
      background: rgba(255, 255, 255, 0.95);
      padding: 20px;
      box-shadow: 0 0 10px #444;
      width: 90%;
      max-width: 400px;
      border-radius: 10px;
    }
    #overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      display: none;
      z-index: 5;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      text-align: center;
    }
    table, th, td {
      border: 1px solid #ccc;
    }
    th, td {
      padding: 10px;
    }
    img.thumb {
      width: 50px;
      height: 50px;
      object-fit: cover;
      border-radius: 4px;
    }
    .highlight {
      background-color: yellow;
    }
    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: #007bff;
      color: white;
      padding: 10px 15px;
      border-radius: 6px;
    }
    .top-bar button {
      width: auto;
      padding: 5px 10px;
      margin: 0 3px;
      font-size: 14px;
      background: #fff;
      color: #007bff;
      border: 1px solid #007bff;
      border-radius: 4px;
    }
    .top-bar button:hover {
      background: #007bff;
      color: white;
    }
  </style>
</head>
<body>
  <!-- HTML content remains the same above -->

  <script>
    const scriptURL = "https://script.google.com/macros/s/YOUR_SCRIPT_ID/exec"; // Replace with your Apps Script URL

    let pigs = [], sales = [], expenses = [];

    window.onload = () => {
      if (localStorage.getItem("loggedIn") === "true") {
        loginBox.style.display = "none";
        mainPage.classList.remove("hidden");
        fetchAllData();
      }
    };

    function login() {
      const u = loginUser.value.trim();
      const p = loginPass.value.trim();
      if (u === "Jituloying" && p === "7896") {
        localStorage.setItem("loggedIn", "true");
        loginBox.style.display = "none";
        mainPage.classList.remove("hidden");
        fetchAllData();
      } else {
        alert("Login Failed!");
      }
    }

    function logout() {
      localStorage.removeItem("loggedIn");
      loginBox.style.display = "block";
      mainPage.classList.add("hidden");
    }

    function fetchAllData() {
      fetch(`${scriptURL}?sheet=Pigs`).then(res => res.json()).then(data => { pigs = data; loadPigList(); });
      fetch(`${scriptURL}?sheet=Sales`).then(res => res.json()).then(data => { sales = data; loadSalesList(); });
      fetch(`${scriptURL}?sheet=Expenses`).then(res => res.json()).then(data => { expenses = data; loadExpenseList(); });
    }

    function addPig() {
      const name = pigName.value.trim(), weight = pigWeight.value, gender = pigGender.value, file = pigImage.files[0];
      if (!name || !weight || !gender || !file) return alert("Fill all fields");
      const reader = new FileReader();
      reader.onload = function (e) {
        const image = e.target.result;
        const time = new Date().toLocaleString();
        const data = { name, weight, gender, image, time };
        fetch(`${scriptURL}?sheet=Pigs`, {
          method: "POST",
          body: JSON.stringify(data),
          headers: { "Content-Type": "application/json" }
        }).then(() => fetchAllData());
        togglePopup('pigFormPopup');
      };
      reader.readAsDataURL(file);
    }

    function sellPig() {
      const pig = sellPigId.value.trim(), buyer = buyerName.value.trim(), price = sellPrice.value, mode = paymentMode.value;
      if (!pig || !buyer || !price) return alert("Fill all fields");
      const time = new Date().toLocaleString();
      const data = { pig, buyer, price, mode, time };
      fetch(`${scriptURL}?sheet=Sales`, {
        method: "POST",
        body: JSON.stringify(data),
        headers: { "Content-Type": "application/json" }
      }).then(() => fetchAllData());
      togglePopup('sellPopup');
    }

    function addExpense() {
      const type = expenseType.value.trim(), amount = expenseAmount.value;
      if (!type || !amount) return alert("Fill all fields");
      const now = new Date(), date = now.toLocaleDateString(), time = now.toLocaleTimeString();
      const data = { type, amount, date, time };
      fetch(`${scriptURL}?sheet=Expenses`, {
        method: "POST",
        body: JSON.stringify(data),
        headers: { "Content-Type": "application/json" }
      }).then(() => fetchAllData());
      togglePopup('expensePopup');
    }

    function loadPigList() {
      pigTableBody.innerHTML = '';
      pigs.forEach((p, i) => {
        pigTableBody.innerHTML += `<tr><td>${i + 1}</td><td>${p.name}</td><td>${p.weight}</td><td>${p.gender}</td><td>${p.time}</td><td><img src="${p.image}" class="thumb"></td><td><button class="btn" onclick="printPig(${i})">üñ®Ô∏è</button></td></tr>`;
      });
    }

    function loadSalesList() {
      salesTableBody.innerHTML = '';
      sales.forEach((s, i) => {
        salesTableBody.innerHTML += `<tr><td>${i + 1}</td><td>${s.pig}</td><td>${s.buyer}</td><td>‚Çπ${s.price}</td><td>${s.mode}</td><td>${s.time}</td><td><button class="btn" onclick="printSale(${i})">üñ®Ô∏è</button></td></tr>`;
      });
    }

    function loadExpenseList() {
      expenseTableBody.innerHTML = '';
      expenses.forEach((e, i) => {
        expenseTableBody.innerHTML += `<tr><td>${i + 1}</td><td>${e.type}</td><td>‚Çπ${e.amount}</td><td>${e.date}</td><td>${e.time}</td><td><button class="btn" onclick="printExpense(${i})">üñ®Ô∏è</button></td></tr>`;
      });
    }

    function printPig(i) {
      const p = pigs[i];
      const w = window.open();
      w.document.write(`<h2>Pig Details</h2><p>Name: ${p.name}</p><p>Weight: ${p.weight}</p><p>Gender: ${p.gender}</p><p>Time: ${p.time}</p><img src="${p.image}" width="150"/>`);
      w.print(); w.close();
    }

    function printSale(i) {
      const s = sales[i];
      const w = window.open();
      w.document.write(`<pre>üêñ Sale Receipt\nDate: ${s.time}\nPig: ${s.pig}\nBuyer: ${s.buyer}\nPrice: ‚Çπ${s.price}\nPayment: ${s.mode}</pre>`);
      w.print(); w.close();
    }

    function printExpense(i) {
      const e = expenses[i];
      const w = window.open();
      w.document.write(`<pre>üìã Expense Receipt\nDate: ${e.date} ${e.time}\nType: ${e.type}\nAmount: ‚Çπ${e.amount}</pre>`);
      w.print(); w.close();
    }

    function togglePopup(id, showOverlay = false) {
      const el = document.getElementById(id);
      el.classList.toggle('hidden');
      overlay.style.display = showOverlay ? 'block' : 'none';
    }

    function toggleSection(id) {
      document.getElementById(id).classList.toggle("hidden");
    }

    function minimize() {
      dashboardContent.style.display = 'none';
    }

    function maximize() {
      dashboardContent.style.display = 'block';
    }

    function register() {
      alert("Registration logic can be implemented here");
      togglePopup('signupPopup');
    }
  </script>
</body>
</html>
