<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>JP Pig Farm Management</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      background: url('th.jpg') no-repeat center center fixed;
      background-size: cover;
    }
    .container, .popup, #mainPage {
      max-width: 500px;
      margin: 40px auto;
      background: rgba(255, 255, 255, 0.95);
      padding: 20px;
      box-shadow: 0 0 10px #aaa;
      border-radius: 10px;
    }
    input, select, button {
      width: 100%;
      padding: 10px;
      margin: 10px 0;
    }
    .hidden { display: none; }
    .btn {
      background: #28a745;
      color: white;
      border: none;
      cursor: pointer;
    }
    .btn:hover { background: #218838; }
    .popup {
      position: fixed;
      top: 10%;
      left: 50%;
      transform: translateX(-50%);
      z-index: 10;
      background: rgba(255, 255, 255, 0.95);
      padding: 20px;
      box-shadow: 0 0 10px #444;
      width: 90%;
      max-width: 400px;
      border-radius: 10px;
    }
    #overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      display: none;
      z-index: 5;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      text-align: center;
    }
    table, th, td {
      border: 1px solid #ccc;
    }
    th, td {
      padding: 10px;
    }
    img.thumb {
      width: 50px;
      height: 50px;
      object-fit: cover;
      border-radius: 4px;
    }
    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: #007bff;
      color: white;
      padding: 10px 15px;
      border-radius: 6px;
    }
    .top-bar button {
      width: auto;
      padding: 5px 10px;
      margin: 0 3px;
      font-size: 14px;
      background: #fff;
      color: #007bff;
      border: 1px solid #007bff;
      border-radius: 4px;
    }
    .top-bar button:hover {
      background: #007bff;
      color: white;
    }
  </style>
</head>
<body>

  <!-- LOGIN -->
  <div class="container" id="loginBox">
    <h2>JP Pig Farm Login</h2>
    <input type="text" id="loginUser" placeholder="Username">
    <input type="password" id="loginPass" placeholder="Password">
    <button class="btn" onclick="login()">Login</button>
  </div>

  <!-- MAIN DASHBOARD -->
  <div id="mainPage" class="container hidden">
    <div class="top-bar">
      <span><strong>üêñ JP Pig Farm Dashboard</strong></span>
      <div>
        <button onclick="minimize()">_</button>
        <button onclick="maximize()">‚ñ≠</button>
        <button onclick="logout()">Logout</button>
      </div>
    </div>

    <div id="dashboardContent">
      <button class="btn" onclick="togglePopup('pigFormPopup', true)">‚ûï Add New Pig</button>
      <button class="btn" onclick="toggleSection('pigList')">üê∑ View Pigs</button>
      <button class="btn" onclick="togglePopup('sellPopup', true)">üí∞ Sell Pig</button>
      <button class="btn" onclick="toggleSection('salesList')">üìë View Sales</button>
      <button class="btn" onclick="togglePopup('expensePopup', true)">üíµ Add Expense</button>
      <button class="btn" onclick="toggleSection('expenseList')">üìã View Expenses</button>

      <div id="pigList" class="hidden" style="margin-top: 20px;">
        <h3>üêñ Pig List</h3>
        <table>
          <thead><tr><th>#</th><th>Name</th><th>Weight</th><th>Gender</th><th>Time</th><th>Image</th><th>Action</th></tr></thead>
          <tbody id="pigTableBody"></tbody>
        </table>
      </div>

      <div id="salesList" class="hidden" style="margin-top:20px;">
        <h3>üìë Sales</h3>
        <table>
          <thead><tr><th>#</th><th>Pig</th><th>Buyer</th><th>Price</th><th>Mode</th><th>Time</th><th>Action</th></tr></thead>
          <tbody id="salesTableBody"></tbody>
        </table>
      </div>

      <div id="expenseList" class="hidden" style="margin-top:20px;">
        <h3>üìã Expenses</h3>
        <table>
          <thead><tr><th>#</th><th>Type</th><th>Amount</th><th>Date</th><th>Time</th><th>Action</th></tr></thead>
          <tbody id="expenseTableBody"></tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- PIG FORM -->
  <div id="pigFormPopup" class="popup hidden">
    <h3>Add New Pig</h3>
    <input type="text" id="pigName" placeholder="Pig Name">
    <input type="number" id="pigWeight" placeholder="Weight (kg)">
    <select id="pigGender"><option value="">Select Gender</option><option>Male</option><option>Female</option></select>
    <input type="file" id="pigImage" accept="image/*">
    <button class="btn" onclick="addPig()">Save Pig</button>
    <button onclick="togglePopup('pigFormPopup')">Close</button>
  </div>

  <!-- SELL PIG -->
  <div id="sellPopup" class="popup hidden">
    <h3>Sell Pig</h3>
    <input type="text" id="sellPigId" placeholder="Pig ID or Name">
    <input type="text" id="buyerName" placeholder="Buyer Name">
    <input type="number" id="sellPrice" placeholder="Sell Price">
    <select id="paymentMode"><option>Cash</option><option>UPI</option><option>Bank Transfer</option></select>
    <button class="btn" onclick="sellPig()">Save Sale</button>
    <button onclick="togglePopup('sellPopup')">Close</button>
  </div>

  <!-- EXPENSE -->
  <div id="expensePopup" class="popup hidden">
    <h3>Add Expense</h3>
    <input type="text" id="expenseType" placeholder="Expense Type">
    <input type="number" id="expenseAmount" placeholder="Amount">
    <button class="btn" onclick="addExpense()">Save Expense</button>
    <button onclick="togglePopup('expensePopup')">Close</button>
  </div>

  <div id="overlay"></div>

  <script>
    const scriptURL = "https://script.google.com/macros/s/AKfycbxEuZdkaAmL0s2QyE2uKZOH4rUBNLG_s65ZKs2w4GX2B3k6jmIFafolOv6b_TK0pe1D/exec";

    let pigs = JSON.parse(localStorage.getItem("pigs") || "[]");
    let sales = JSON.parse(localStorage.getItem("sales") || "[]");
    let expenses = JSON.parse(localStorage.getItem("expenses") || "[]");

    window.onload = () => {
      if (localStorage.getItem("loggedIn") === "true") {
        loginBox.style.display = "none";
        mainPage.classList.remove("hidden");
      }
    };

    function login() {
      const u = loginUser.value, p = loginPass.value;
      if (u === "Jituloying" && p === "7896") {
        localStorage.setItem("loggedIn", "true");
        loginBox.style.display = "none";
        mainPage.classList.remove("hidden");
      } else {
        alert("Login Failed!");
      }
    }

    function logout() {
      localStorage.removeItem("loggedIn");
      mainPage.classList.add("hidden");
      loginBox.style.display = "block";
    }

    function minimize() { dashboardContent.style.display = 'none'; }
    function maximize() { dashboardContent.style.display = 'block'; }

    function togglePopup(id, showOverlay = false) {
      document.getElementById(id).classList.toggle("hidden");
      overlay.style.display = showOverlay ? 'block' : 'none';
    }

    function toggleSection(id) {
      document.getElementById(id).classList.toggle("hidden");
      if (id === 'pigList') loadPigList();
      if (id === 'salesList') loadSales();
      if (id === 'expenseList') loadExpenses();
    }

    function addPig() {
      const name = pigName.value, weight = pigWeight.value, gender = pigGender.value;
      const file = pigImage.files[0];
      if (!name || !weight || !gender || !file) return alert("All fields required");
      const reader = new FileReader();
      reader.onload = function(e) {
        const image = e.target.result;
        const time = new Date().toLocaleString();
        pigs.push({ name, weight, gender, image, time });
        localStorage.setItem("pigs", JSON.stringify(pigs));
        togglePopup('pigFormPopup');
        loadPigList();
        fetch(`${scriptURL}?sheet=Pigs`, {
          method: "POST",
          body: JSON.stringify({ name, weight, gender, image }),
          headers: { "Content-Type": "application/json" }
        });
      };
      reader.readAsDataURL(file);
    }

    function sellPig() {
      const pig = sellPigId.value, buyer = buyerName.value, price = sellPrice.value, mode = paymentMode.value;
      if (!pig || !buyer || !price) return alert("All fields required");
      const time = new Date().toLocaleString();
      sales.push({ pig, buyer, price, mode, time });
      localStorage.setItem("sales", JSON.stringify(sales));
      togglePopup('sellPopup');
      loadSales();
      fetch(`${scriptURL}?sheet=Sales`, {
        method: "POST",
        body: JSON.stringify({ pig, buyer, price, mode }),
        headers: { "Content-Type": "application/json" }
      });
    }

    function addExpense() {
      const type = expenseType.value, amount = expenseAmount.value;
      const now = new Date(), date = now.toLocaleDateString(), time = now.toLocaleTimeString();
      if (!type || !amount) return alert("Fill all fields");
      expenses.push({ type, amount, date, time });
      localStorage.setItem("expenses", JSON.stringify(expenses));
      togglePopup('expensePopup');
      loadExpenses();
      fetch(`${scriptURL}?sheet=Expenses`, {
        method: "POST",
        body: JSON.stringify({ type, amount }),
        headers: { "Content-Type": "application/json" }
      });
    }

    function loadPigList() {
      pigTableBody.innerHTML = '';
      pigs.forEach((p, i) => {
        pigTableBody.innerHTML += `<tr>
          <td>${i+1}</td><td>${p.name}</td><td>${p.weight}</td><td>${p.gender}</td>
          <td>${p.time}</td><td><img src="${p.image}" class="thumb"></td>
          <td><button class="btn" onclick="printPig(${i})">üñ®Ô∏è</button></td>
        </tr>`;
      });
    }

    function printPig(i) {
      const p = pigs[i];
      const w = window.open();
      w.document.write(`<h2>Pig Details</h2><p>Name: ${p.name}</p><p>Weight: ${p.weight}</p><p>Gender: ${p.gender}</p><p>Time: ${p.time}</p><img src="${p.image}" width="150"/>`);
      w.print(); w.close();
    }

    function loadSales() {
      salesTableBody.innerHTML = '';
      sales.forEach((s, i) => {
        salesTableBody.innerHTML += `<tr>
          <td>${i+1}</td><td>${s.pig}</td><td>${s.buyer}</td><td>‚Çπ${s.price}</td>
          <td>${s.mode}</td><td>${s.time}</td>
          <td><button class="btn" onclick="printSale(${i})">üñ®Ô∏è</button></td>
        </tr>`;
      });
    }

    function printSale(i) {
      const s = sales[i];
      const w = window.open();
      w.document.write(`<pre>üêñ Sale Receipt
Date: ${s.time}
Pig: ${s.pig}
Buyer: ${s.buyer}
Price: ‚Çπ${s.price}
Payment: ${s.mode}</pre>`);
      w.print(); w.close();
    }

    function loadExpenses() {
      expenseTableBody.innerHTML = '';
      expenses.forEach((e, i) => {
        expenseTableBody.innerHTML += `<tr>
          <td>${i+1}</td><td>${e.type}</td><td>‚Çπ${e.amount}</td>
          <td>${e.date}</td><td>${e.time}</td>
          <td><button class="btn" onclick="printExpense(${i})">üñ®Ô∏è</button></td>
        </tr>`;
      });
    }

    function printExpense(i) {
      const e = expenses[i];
      const w = window.open();
      w.document.write(`<pre>üìã Expense Receipt
Date: ${e.date} ${e.time}
Type: ${e.type}
Amount: ‚Çπ${e.amount}</pre>`);
      w.print(); w.close();
    }
  </script>
</body>
</html>
